<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—ä—Å—Ç–µ–∑–∞–Ω–∏–µ –ì–æ—Å–ø–æ–∂–∏ –†–∞–¥–µ–≤–∞ –∏ –¶–æ–Ω–µ–≤–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 900px;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.2rem;
        }
        
        .competitors {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .competitor {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            width: 100%;
            max-width: 350px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .competitor:hover {
            transform: translateY(-5px);
        }
        
        .competitor h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .counter {
            font-size: 4rem;
            font-weight: bold;
            color: #3498db;
            margin: 20px 0;
        }
        
        .btn {
            background: linear-gradient(to right, #3498db, #2c3e50);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: scale(1.05);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-reset {
            background: linear-gradient(to right, #e74c3c, #c0392b);
        }
        
        .results {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .results h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .result-text {
            font-size: 1.3rem;
            color: #34495e;
            margin: 10px 0;
        }
        
        .leader {
            border: 3px solid #f1c40f;
            background: #fff9c4;
            position: relative;
        }
        
        .leader::after {
            content: "–õ–ò–î–ï–†";
            position: absolute;
            top: -15px;
            right: 20px;
            background: #f1c40f;
            color: #2c3e50;
            padding: 5px 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .connected {
            background-color: #d4edda;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .cooldown {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <h1>–°—ä—Å—Ç–µ–∑–∞–Ω–∏–µ "–ö–∞–∑–∞—Ö–∞ –ì–æ—Å–ø–æ–∂–æ"</h1>
        <p class="subtitle">–ì-–∂–∞ –†–∞–¥–µ–≤–∞ vs –ì-–∂–∞ –¶–æ–Ω–µ–≤–∞ - –í –†–ï–ê–õ–ù–û –í–†–ï–ú–ï</p>
        
        <div class="status" id="status">üîÑ –°–≤—ä—Ä–∑–≤–∞–Ω–µ —Å Firebase...</div>
        
        <div class="competitors">
            <div class="competitor" id="radeva">
                <h2>–ì-–∂–∞ –†–∞–¥–µ–≤–∞</h2>
                <div class="counter" id="radeva-counter">0</div>
                <button class="btn" onclick="addVote('radeva')" id="btn-radeva">–ö–∞–∑–∞—Ö–∞ –ì–æ—Å–ø–æ–∂–æ +1</button>
                <div class="cooldown" id="cooldown-radeva"></div>
            </div>
            
            <div class="competitor" id="tsoneva">
                <h2>–ì-–∂–∞ –¶–æ–Ω–µ–≤–∞</h2>
                <div class="counter" id="tsoneva-counter">0</div>
                <button class="btn" onclick="addVote('tsoneva')" id="btn-tsoneva">–ö–∞–∑–∞—Ö–∞ –ì–æ—Å–ø–æ–∂–æ +1</button>
                <div class="cooldown" id="cooldown-tsoneva"></div>
            </div>
        </div>
        
        <div class="results">
            <h3>–¢–µ–∫—É—â–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ</h3>
            <div class="result-text" id="result-text">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
            <button class="btn btn-reset" onclick="resetScores()" id="btn-reset">–ù—É–ª–∏—Ä–∞–π —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ</button>
            <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">–°–∞–º–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ –¥–∞ –Ω—É–ª–∏—Ä–∞</p>
        </div>
    </div>

    <script>
        // –í–∞—à–∞—Ç–∞ Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const firebaseConfig = {
            apiKey: "AIzaSyCr3fMjIV_wFhkD0AiWs2e_O6IKcsKfnfQ",
            authDomain: "gospogho-counter.firebaseapp.com",
            databaseURL: "https://gospogho-counter-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "gospogho-counter",
            storageBucket: "gospogho-counter.firebasestorage.app",
            messagingSenderId: "498181065339",
            appId: "1:498181065339:web:585cd8ce951d1f46dff0de",
            measurementId: "G-339XR9LYEZ"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Firebase
        let database;
        let lastVoteTime = {
            radeva: 0,
            tsoneva: 0
        };
        const VOTE_COOLDOWN = 2000; // 2 —Å–µ–∫—É–Ω–¥–∏ –∫–æ–æ–ª–¥–∞—É–Ω

        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            document.getElementById('status').className = 'status connected';
            document.getElementById('status').textContent = '‚úÖ –°–≤—ä—Ä–∑–∞–Ω —Å Firebase! –î–∞–Ω–Ω–∏—Ç–µ —Å–∞ –∑–∞—â–∏—Ç–µ–Ω–∏.';
        } catch (error) {
            document.getElementById('status').className = 'status error';
            document.getElementById('status').textContent = '‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Å–≤—ä—Ä–∑–≤–∞–Ω–µ: ' + error.message;
        }

        // –†–µ—Ñ–µ—Ä–µ–Ω—Ü–∏–∏
        const scoresRef = database.ref('scores');
        const votesRef = database.ref('votes');

        // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –Ω–∞—á–∞–ª–Ω–∏ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏
        scoresRef.once('value').then((snapshot) => {
            if (!snapshot.exists()) {
                scoresRef.set({ radeva: 0, tsoneva: 0 });
            }
        });

        // –°–ª—É—à–∞—Ç–µ–ª –∑–∞ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ
        scoresRef.on('value', (snapshot) => {
            const data = snapshot.val() || { radeva: 0, tsoneva: 0 };
            
            document.getElementById('radeva-counter').textContent = data.radeva || 0;
            document.getElementById('tsoneva-counter').textContent = data.tsoneva || 0;
            
            updateResults(data.radeva || 0, data.tsoneva || 0);
            updateLeader(data.radeva || 0, data.tsoneva || 0);
        });

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –≥–ª–∞—Å—É–≤–∞–Ω–µ
        function addVote(teacher) {
            if (!database) {
                alert('Firebase –Ω–µ –µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω!');
                return;
            }

            const now = Date.now();
            const timeSinceLastVote = now - lastVoteTime[teacher];

            // –ö–æ–æ–ª–¥–∞—É–Ω –∑–∞—â–∏—Ç–∞
            if (timeSinceLastVote < VOTE_COOLDOWN) {
                const remaining = Math.ceil((VOTE_COOLDOWN - timeSinceLastVote) / 1000);
                document.getElementById(`cooldown-${teacher}`).textContent = `–ò–∑—á–∞–∫–∞–π—Ç–µ ${remaining}—Å–µ–∫`;
                return;
            }

            lastVoteTime[teacher] = now;
            document.getElementById(`cooldown-${teacher}`).textContent = '';

            // –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –≥–ª–∞—Å —á—Ä–µ–∑ votes —Å–∏—Å—Ç–µ–º–∞
            const newVoteRef = votesRef.push();
            newVoteRef.set({
                teacher: teacher,
                timestamp: now,
                type: 'vote'
            }).then(() => {
                console.log('–ì–ª–∞—Å—ä—Ç –µ –∑–∞–ø–∏—Å–∞–Ω —É—Å–ø–µ—à–Ω–æ');
            }).catch((error) => {
                console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≥–ª–∞—Å—É–≤–∞–Ω–µ:', error);
                alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ —Ç–æ—á–∫–∞. –û–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ.');
            });

            // –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –∫–æ–æ–ª–¥–∞—É–Ω
            updateCooldown(teacher);
        }

        function updateCooldown(teacher) {
            const button = document.getElementById(`btn-${teacher}`);
            const cooldownElement = document.getElementById(`cooldown-${teacher}`);
            
            button.disabled = true;
            let secondsLeft = VOTE_COOLDOWN / 1000;
            
            const countdown = setInterval(() => {
                secondsLeft--;
                cooldownElement.textContent = `–ú–æ–∂–µ—Ç–µ –¥–∞ –≥–ª–∞—Å—É–≤–∞—Ç–µ —Å–ª–µ–¥ ${secondsLeft}—Å–µ–∫`;
                
                if (secondsLeft <= 0) {
                    clearInterval(countdown);
                    button.disabled = false;
                    cooldownElement.textContent = '';
                }
            }, 1000);
        }

        function resetScores() {
            const password = prompt('–í—ä–≤–µ–¥–µ—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∞ –ø–∞—Ä–æ–ª–∞ –∑–∞ –Ω—É–ª–∏—Ä–∞–Ω–µ:');
            // –ü—Ä–æ—Å—Ç–∞ –ø–∞—Ä–æ–ª–∞ - –º–æ–∂–µ –¥–∞ —è –ø—Ä–æ–º–µ–Ω–∏—Ç–µ
            if (password === 'admin123') {
                if (confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –Ω—É–ª–∏—Ä–∞—Ç–µ –≤—Å–∏—á–∫–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏?')) {
                    scoresRef.set({ radeva: 0, tsoneva: 0 });
                }
            } else {
                alert('–ù–µ–ø—Ä–∞–≤–∏–ª–Ω–∞ –ø–∞—Ä–æ–ª–∞!');
            }
        }

        function updateResults(radeva, tsoneva) {
            const resultElement = document.getElementById('result-text');
            
            if (radeva === 0 && tsoneva === 0) {
                resultElement.textContent = '–°—ä—Å—Ç–µ–∑–∞–Ω–∏–µ—Ç–æ –æ—â–µ –Ω–µ –µ –∑–∞–ø–æ—á–Ω–∞–ª–æ';
            } else if (radeva > tsoneva) {
                resultElement.textContent = `–ì-–∂–∞ –†–∞–¥–µ–≤–∞ –≤–æ–¥–∏ —Å ${radeva - tsoneva} —Ç–æ—á–∫–∏`;
            } else if (tsoneva > radeva) {
                resultElement.textContent = `–ì-–∂–∞ –¶–æ–Ω–µ–≤–∞ –≤–æ–¥–∏ —Å ${tsoneva - radeva} —Ç–æ—á–∫–∏`;
            } else {
                resultElement.textContent = '–†–∞–≤–Ω–∏—â–µ! –ò –¥–≤–µ—Ç–µ –∏–º–∞—Ç –µ–¥–Ω–∞–∫—ä–≤ –±—Ä–æ–π —Ç–æ—á–∫–∏';
            }
        }

        function updateLeader(radeva, tsoneva) {
            const radevaElement = document.getElementById('radeva');
            const tsonevaElement = document.getElementById('tsoneva');
            
            radevaElement.classList.remove('leader');
            tsonevaElement.classList.remove('leader');
            
            if (radeva > tsoneva) {
                radevaElement.classList.add('leader');
            } else if (tsoneva > radeva) {
                tsonevaElement.classList.add('leader');
            }
        }

        // Cloud Function –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≥–ª–∞—Å–æ–≤–µ (—Å–∏–º—É–ª–∏—Ä–∞–Ω–∞)
        votesRef.on('child_added', (snapshot) => {
            const vote = snapshot.val();
            if (vote && vote.teacher) {
                // –°–∏–º—É–ª–∏—Ä–∞–º–µ cloud function - —É–≤–µ–ª–∏—á–∞–≤–∞–º–µ —Ç–æ—á–∫–∏—Ç–µ
                setTimeout(() => {
                    const teacherRef = scoresRef.child(vote.teacher);
                    teacherRef.transaction((current) => (current || 0) + 1);
                }, 100);
            }
        });
    </script>
</body>
</html>